<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<title>PDF Swipe Viewer (Select File)</title>
		<style>
			body,
			html {
				margin: 0;
				padding: 0;
				height: 100%;
				display: flex;
				justify-content: center;
				align-items: center;
				background-color: #f0f0f0;
				flex-direction: column;
			}
			canvas {
				border: 1px solid #aaa;
				cursor: grab;
				width: 100vw;
				height: 100vh;
				object-fit: contain;
			}
			#info {
				position: absolute;
				top: 10px;
				left: 10px;
				font-size: 18px;
				color: #fff;
				/* background-color: rgba(0, 0, 0, 0.5); */
				padding: 5px 10px;
				border-radius: 5px;
			}
			/* Button styles */
			#prev-btn,
			#next-btn {
				position: absolute;
				top: 50%;
				transform: translateY(-50%);
				background-color: rgba(0, 0, 0, 0.7);
				color: white;
				font-size: 20px;
				padding: 10px 20px;
				border: none;
				border-radius: 5px;
				cursor: pointer;
				transition: background-color 0.3s;
			}
			#prev-btn {
				left: 10px;
			}
			#next-btn {
				right: 10px;
			}
			#prev-btn:hover,
			#next-btn:hover {
				background-color: rgba(0, 0, 0, 0.9);
			}
		</style>
	</head>
	<body>
		<input
			type="file"
			id="pdf-input"
			accept="application/pdf"
			style="display: none"
		/>
		<canvas id="pdf-canvas"></canvas>
		<div id="info" style="display: none">
			<span id="page-num" style="display: none"></span>
			<span id="page-count" style="display: none"></span>
		</div>
		<!-- PDF.js from CDN -->
		<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.10.111/pdf.min.js"></script>
		<script>
			const pdfs = [
				"Kỷ yếu Hội bảo trợ NKT_1.pdf",
				"Kỷ yếu Hội bảo trợ NKT_2.pdf",
			];
			let currentPdfIndex = 0;

			const input = document.getElementById("pdf-input");
			const canvas = document.getElementById("pdf-canvas");
			const ctx = canvas.getContext("2d");
			const pageNumEl = document.getElementById("page-num");
			const pageCountEl = document.getElementById("page-count");
			const info = document.getElementById("info");

			let pdfDoc = null;
			let currentPage = 1;

			function renderPage(num) {
				pdfDoc.getPage(num).then((page) => {
					const viewport = page.getViewport({ scale: 1.5 });
					canvas.height = viewport.height;
					canvas.width = viewport.width;

					const renderContext = {
						canvasContext: ctx,
						viewport: viewport,
					};
					page.render(renderContext);
					pageNumEl.textContent = num;
				});
			}

			function loadPdf(url) {
				pdfjsLib.getDocument(url).promise.then((pdf) => {
					pdfDoc = pdf;
					currentPage = 1;
					pageCountEl.textContent = pdfDoc.numPages;
					info.style.display = "block";
					renderPage(currentPage);
				});
			}

			function nextPage() {
				console.log(currentPage, pdfDoc.numPages, currentPdfIndex, pdfs.length);
				if (currentPage < pdfDoc.numPages) {
					currentPage++;
					renderPage(currentPage);
				} else if (currentPdfIndex < pdfs.length - 1) {
					// Move to next PDF
					currentPdfIndex++;
					loadPdf(pdfs[currentPdfIndex]);
				}
			}

			function prevPage() {
				if (currentPage > 1) {
					currentPage--;
					renderPage(currentPage);
				}
			}

			// Load the first PDF initially
			loadPdf(pdfs[currentPdfIndex]);

			// Swipe detection (mouse drag)
			let startX = null;
			canvas.addEventListener("mousedown", (e) => {
				startX = e.clientX;
			});

			canvas.addEventListener("mouseup", (e) => {
				if (startX === null) return;
				const deltaX = e.clientX - startX;
				if (Math.abs(deltaX) > 50) {
					if (deltaX < 0) {
						nextPage(); // swipe left
					} else {
						prevPage(); // swipe right
					}
				}
				startX = null;
			});

			input.addEventListener("change", (e) => {
				const file = e.target.files[0];

				if (!file || file.type !== "application/pdf") return;

				const reader = new FileReader();
				reader.onload = function () {
					const typedArray = new Uint8Array(this.result);
					pdfjsLib.getDocument(typedArray).promise.then((pdf) => {
						pdfDoc = pdf;
						currentPage = 1;
						pageCountEl.textContent = pdfDoc.numPages;
						info.style.display = "block";
						renderPage(currentPage);
					});
				};
				reader.readAsArrayBuffer(file);
			});

			// Wait for the DOM to fully load before adding event listeners
			window.addEventListener("DOMContentLoaded", () => {
				// Button functionality
				document.getElementById("next-btn").addEventListener("click", nextPage);
				document.getElementById("prev-btn").addEventListener("click", prevPage);
			});
		</script>

		<!-- Buttons -->
		<button id="prev-btn">Previous</button>
		<button id="next-btn">Next</button>
	</body>
</html>
