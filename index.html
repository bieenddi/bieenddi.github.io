<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<title>PDF Swipe Viewer</title>
		<style>
			body,
			html {
				margin: 0;
				padding: 0;
				height: 100%;
				display: flex;
				justify-content: center;
				align-items: center;
				background-color: #f0f0f0;
				flex-direction: column;
			}
			canvas {
				border: 1px solid #aaa;
				cursor: grab;
				width: 100vw;
				height: 100vh;
				object-fit: contain;
				touch-action: none;
			}
			#info {
				position: absolute;
				top: 10px;
				left: 10px;
				font-size: 18px;
				color: #fff;
				padding: 5px 10px;
				border-radius: 5px;
			}
			#prev-btn,
			#next-btn,
			#first-btn,
			#last-btn,
			#goto-btn {
				position: absolute;
				top: 50%;
				transform: translateY(-50%);
				background-color: rgba(0, 0, 0, 0.7);
				color: white;
				font-size: 16px;
				padding: 8px 16px;
				border: none;
				border-radius: 5px;
				cursor: pointer;
				transition: background-color 0.3s;
			}
			#prev-btn:hover,
			#next-btn:hover,
			#first-btn:hover,
			#last-btn:hover,
			#goto-btn:hover {
				background-color: rgba(0, 0, 0, 0.9);
			}
			#prev-btn {
				left: 10px;
			}
			#next-btn {
				right: 10px;
			}
			#first-btn {
				left: 10px;
				top: 10px;
				transform: none;
			}
			#last-btn {
				right: 10px;
				top: 10px;
				transform: none;
			}

			#goto-container {
				position: absolute;
				bottom: 10px;
				left: 50%;
				transform: translateX(-50%);
				gap: 5px;
			}
			#goto-input {
				padding: 5px;
				font-size: 16px;
				width: 80px;
			}
		</style>
	</head>
	<body>
		<canvas id="pdf-canvas"></canvas>
		<div id="info" style="display: none">
			<span id="page-num" style="display: none"></span>
			<span id="page-count" style="display: none"></span>
		</div>

		<!-- Buttons -->
		<button id="prev-btn">Previous</button>
		<button id="next-btn">Next</button>
		<button id="first-btn">First</button>
		<button id="last-btn">Last</button>

		<!-- Go To Page UI -->
		<div id="goto-container">
			<input type="number" id="goto-input" placeholder="Page #" min="1" />
			<button id="goto-btn">Go</button>
		</div>

		<!-- PDF.js from CDN -->
		<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.10.111/pdf.min.js"></script>
		<script>
			const pdfs = [
				"Kỷ yếu Hội bảo trợ NKT_1.pdf", // 35 pages
				"Kỷ yếu Hội bảo trợ NKT_2.pdf", // 39 pages
			];

			let currentPdfIndex = 0;
			let currentPage = 1;
			let pdfDoc = null;
			let totalPages = 0;
			let pdfPageCounts = [];

			const canvas = document.getElementById("pdf-canvas");
			const ctx = canvas.getContext("2d");
			const pageNumEl = document.getElementById("page-num");
			const pageCountEl = document.getElementById("page-count");
			const info = document.getElementById("info");

			async function preloadAllPdfPageCounts() {
				totalPages = 0;
				for (let i = 0; i < pdfs.length; i++) {
					const pdf = await pdfjsLib.getDocument(pdfs[i]).promise;
					pdfPageCounts[i] = pdf.numPages;
					totalPages += pdf.numPages;
				}
				document.getElementById("goto-input").setAttribute("max", totalPages);
			}

			function renderPage(num) {
				pdfDoc.getPage(num).then((page) => {
					const viewport = page.getViewport({ scale: 1.5 });
					canvas.height = viewport.height;
					canvas.width = viewport.width;

					page.render({
						canvasContext: ctx,
						viewport: viewport,
					});
					pageNumEl.textContent = num;
				});
			}

			function loadPdf(url, goToPage = 1) {
				pdfjsLib.getDocument(url).promise.then((pdf) => {
					pdfDoc = pdf;
					currentPage = goToPage;
					pageCountEl.textContent = pdf.numPages;
					info.style.display = "block";
					renderPage(currentPage);
				});
			}

			function nextPage() {
				if (currentPage < pdfDoc.numPages) {
					currentPage++;
					renderPage(currentPage);
				} else if (currentPdfIndex < pdfs.length - 1) {
					currentPdfIndex++;
					loadPdf(pdfs[currentPdfIndex], 1);
				}
			}

			function prevPage() {
				if (currentPage > 1) {
					currentPage--;
					renderPage(currentPage);
				} else if (currentPdfIndex > 0) {
					currentPdfIndex--;
					loadPdf(pdfs[currentPdfIndex], pdfPageCounts[currentPdfIndex]);
				}
			}

			function goToFirst() {
				currentPdfIndex = 0;
				loadPdf(pdfs[0], 1);
			}

			function goToLast() {
				currentPdfIndex = pdfs.length - 1;
				loadPdf(pdfs[currentPdfIndex], pdfPageCounts[pdfs.length - 1]);
			}

			function mapGlobalToLocalPage(globalPageNumber) {
				let page = globalPageNumber;
				for (let i = 0; i < pdfPageCounts.length; i++) {
					if (page <= pdfPageCounts[i]) {
						return { pdfIndex: i, localPage: page };
					}
					page -= pdfPageCounts[i];
				}
				return null;
			}

			function goToGlobalPage(globalPageNumber) {
				const map = mapGlobalToLocalPage(globalPageNumber);
				if (!map) return alert(`Page ${globalPageNumber} is out of range`);
				if (map.pdfIndex !== currentPdfIndex) {
					currentPdfIndex = map.pdfIndex;
					loadPdf(pdfs[currentPdfIndex], map.localPage);
				} else {
					currentPage = map.localPage;
					renderPage(currentPage);
				}
			}

			function goToPage() {
				const input = document.getElementById("goto-input");
				const page = parseInt(input.value);
				if (!isNaN(page) && page >= 1 && page <= totalPages) {
					goToGlobalPage(page);
					input.value = "";
					input.blur();
				} else {
					alert(`Please enter a valid page number (1 - ${totalPages})`);
				}
			}

			// Swipe detection: Mouse + Touch
			let startX = null;
			canvas.addEventListener("mousedown", (e) => (startX = e.clientX));
			canvas.addEventListener("mouseup", (e) => {
				if (startX === null) return;
				const deltaX = e.clientX - startX;
				if (Math.abs(deltaX) > 50) deltaX < 0 ? nextPage() : prevPage();
				startX = null;
			});
			canvas.addEventListener(
				"touchstart",
				(e) => {
					if (e.touches.length === 1) startX = e.touches[0].clientX;
				},
				{ passive: true }
			);
			canvas.addEventListener(
				"touchend",
				(e) => {
					if (startX === null) return;
					const endX = e.changedTouches[0].clientX;
					const deltaX = endX - startX;
					if (Math.abs(deltaX) > 50) deltaX < 0 ? nextPage() : prevPage();
					startX = null;
				},
				{ passive: true }
			);

			window.addEventListener("DOMContentLoaded", async () => {
				await preloadAllPdfPageCounts();
				loadPdf(pdfs[currentPdfIndex]);
				document.getElementById("next-btn").addEventListener("click", nextPage);
				document.getElementById("prev-btn").addEventListener("click", prevPage);
				document
					.getElementById("first-btn")
					.addEventListener("click", goToFirst);
				document.getElementById("last-btn").addEventListener("click", goToLast);
				document.getElementById("goto-btn").addEventListener("click", goToPage);
			});
		</script>
	</body>
</html>
