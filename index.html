<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<title>PDF Swipe Viewer (Select File)</title>
		<style>
			body,
			html {
				margin: 0;
				padding: 0;
				height: 100%;
				display: flex;
				justify-content: center;
				align-items: center;
				background-color: #f0f0f0;
				flex-direction: column;
			}
			canvas {
				border: 1px solid #aaa;
				cursor: grab;
				width: 100vw;
				height: 100vh;
				object-fit: contain;
				touch-action: none;
			}
			#info {
				position: absolute;
				top: 10px;
				left: 50%;
				transform: translateX(-50%);
				font-size: 18px;
				color: #fff;
				padding: 5px 10px;
				border-radius: 5px;
				z-index: 10;
			}
			#prev-btn,
			#next-btn,
			#first-btn,
			#last-btn {
				position: absolute;
				top: 50%;
				transform: translateY(-50%);
				background-color: rgba(0, 0, 0, 0.7);
				color: white;
				font-size: 16px;
				padding: 8px 16px;
				border: none;
				border-radius: 5px;
				cursor: pointer;
				transition: background-color 0.3s;
				z-index: 10;
			}
			#prev-btn {
				left: 10px;
			}
			#next-btn {
				right: 10px;
			}
			#first-btn {
				left: 10px;
				top: 10px;
				transform: none;
			}
			#last-btn {
				right: 10px;
				top: 10px;
				transform: none;
			}
			#prev-btn:hover,
			#next-btn:hover,
			#first-btn:hover,
			#last-btn:hover,
			#goto-btn:hover {
				background-color: rgba(0, 0, 0, 0.9);
			}
			#goto-container {
				position: absolute;
				bottom: 10px;
				left: 50%;
				transform: translateX(-50%);
				display: flex;
				gap: 5px;
				z-index: 10;
			}
			#goto-input {
				padding: 5px;
				font-size: 16px;
				width: 80px;
			}
			#goto-btn {
				background-color: rgba(0, 0, 0, 0.7);
				color: white;
				font-size: 16px;
				padding: 5px 12px;
				border: none;
				border-radius: 5px;
				cursor: pointer;
			}
			#loading {
				display: none;
				position: absolute;
				top: 50%;
				left: 50%;
				transform: translate(-50%, -50%);
				background: rgba(0, 0, 0, 0.7);
				color: white;
				padding: 10px 20px;
				border-radius: 8px;
				font-size: 18px;
				z-index: 1000;
			}
		</style>
	</head>
	<body>
		<input
			type="file"
			id="pdf-input"
			accept="application/pdf"
			style="display: none"
		/>
		<canvas id="pdf-canvas"></canvas>
		<div id="info" style="display: none">
			<span id="page-num" style="display: none"></span>
			<span id="page-count" style="display: none"></span>
		</div>
		<div id="goto-container" style="display: none">
			<input
				type="number"
				id="goto-input"
				min="1"
				placeholder="Tới trang"
				style="display: none"
			/>
			<button id="goto-btn" style="display: none">Go</button>
		</div>
		<div id="loading">Đang tải...</div>

		<!-- Navigation Buttons -->
		<button id="prev-btn">Trước</button>
		<button id="next-btn">Tiếp</button>

		<!-- PDF.js from CDN -->
		<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.10.111/pdf.min.js"></script>
		<script>
			const pdfs = [
				"Kỷ yếu Hội bảo trợ NKT_1.pdf",
				"Kỷ yếu Hội bảo trợ NKT_2.pdf",
			];
			let currentPdfIndex = 0;

			const input = document.getElementById("pdf-input");
			const canvas = document.getElementById("pdf-canvas");
			const ctx = canvas.getContext("2d");
			const pageNumEl = document.getElementById("page-num");
			const pageCountEl = document.getElementById("page-count");
			const info = document.getElementById("info");
			const loading = document.getElementById("loading");

			let pdfDoc = null;
			let currentPage = 1;

			function showLoading(state) {
				loading.style.display = state ? "block" : "none";
			}

			function renderPage(num) {
				showLoading(true);
				pdfDoc.getPage(num).then((page) => {
					const viewport = page.getViewport({ scale: 1.5 });
					canvas.height = viewport.height;
					canvas.width = viewport.width;

					const renderContext = {
						canvasContext: ctx,
						viewport: viewport,
					};

					page.render(renderContext).promise.then(() => {
						pageNumEl.textContent = num;
						showLoading(false);
					});
				});
			}

			function loadPdf(url, goToLastPage = false) {
				showLoading(true);
				pdfjsLib
					.getDocument(url)
					.promise.then((pdf) => {
						pdfDoc = pdf;
						currentPage = goToLastPage ? pdfDoc.numPages : 1;
						pageCountEl.textContent = pdfDoc.numPages;
						info.style.display = "block";
						renderPage(currentPage);
					})
					.finally(() => showLoading(false));
			}

			function nextPage() {
				if (currentPage < pdfDoc.numPages) {
					currentPage++;
					renderPage(currentPage);
				} else if (currentPdfIndex < pdfs.length - 1) {
					currentPdfIndex++;
					loadPdf(pdfs[currentPdfIndex]);
				}
			}

			function prevPage() {
				if (currentPage > 1) {
					currentPage--;
					renderPage(currentPage);
				} else if (currentPdfIndex > 0) {
					currentPdfIndex--;
					loadPdf(pdfs[currentPdfIndex], true); // load last page of previous PDF
				}
			}

			function firstPage() {
				currentPage = 1;
				renderPage(currentPage);
			}

			function lastPage() {
				currentPage = pdfDoc.numPages;
				renderPage(currentPage);
			}

			function goToPage() {
				const inputEl = document.getElementById("goto-input");
				const inputVal = parseInt(inputEl.value);
				if (isNaN(inputVal) || inputVal < 1) {
					alert("Please enter a valid page number.");
					return;
				}

				// Assume first PDF has 35 pages
				const pdf1Pages = 35;

				const clearAndRender = (pageNumber) => {
					currentPage = pageNumber;
					renderPage(currentPage);
					inputEl.value = ""; // Clear input after rendering starts
				};

				if (inputVal <= pdf1Pages) {
					if (currentPdfIndex !== 0) {
						currentPdfIndex = 0;
						loadPdf(pdfs[0]);
						setTimeout(() => clearAndRender(inputVal), 300);
					} else {
						clearAndRender(inputVal);
					}
				} else {
					// Page from second PDF
					const pageInSecondPdf = inputVal - pdf1Pages;
					if (currentPdfIndex !== 1) {
						currentPdfIndex = 1;
						loadPdf(pdfs[1]);
						setTimeout(() => clearAndRender(pageInSecondPdf), 300);
					} else {
						clearAndRender(pageInSecondPdf);
					}
				}
			}

			// Swipe Detection (Mouse + Touch)
			let startX = null;
			canvas.addEventListener("mousedown", (e) => (startX = e.clientX));
			canvas.addEventListener("mouseup", (e) => {
				if (startX === null) return;
				const deltaX = e.clientX - startX;
				if (Math.abs(deltaX) > 50) {
					deltaX < 0 ? nextPage() : prevPage();
				}
				startX = null;
			});
			canvas.addEventListener(
				"touchstart",
				(e) => (startX = e.touches[0].clientX)
			);
			canvas.addEventListener("touchend", (e) => {
				if (startX === null) return;
				const endX = e.changedTouches[0].clientX;
				const deltaX = endX - startX;
				if (Math.abs(deltaX) > 50) {
					deltaX < 0 ? nextPage() : prevPage();
				}
				startX = null;
			});

			document.getElementById("next-btn").addEventListener("click", nextPage);
			document.getElementById("prev-btn").addEventListener("click", prevPage);
			document.getElementById("goto-btn").addEventListener("click", goToPage);

			input.addEventListener("change", (e) => {
				const file = e.target.files[0];
				if (!file || file.type !== "application/pdf") return;

				showLoading(true);
				const reader = new FileReader();
				reader.onload = function () {
					const typedArray = new Uint8Array(this.result);
					pdfjsLib
						.getDocument(typedArray)
						.promise.then((pdf) => {
							pdfDoc = pdf;
							currentPage = 1;
							pageCountEl.textContent = pdfDoc.numPages;
							info.style.display = "block";
							renderPage(currentPage);
						})
						.finally(() => showLoading(false));
				};
				reader.readAsArrayBuffer(file);
			});

			window.addEventListener("DOMContentLoaded", () => {
				loadPdf(pdfs[currentPdfIndex]);
			});
		</script>
	</body>
</html>
